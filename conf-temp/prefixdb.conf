{
    "startup":{},

    "config": {
        "enabled": true,
        "reload_changed_ms": 1000,
        "reload_sighup": true
    },

    "core": {
        "rlimit_as_mb": 0,
        "enable_callback_check": true,
        "core_timeout_ms": 1000,
        "idle_timeout_ms": 1000,
        "cpu":[1,2,3],
        "core-workflow": {
            "threads": 1,
            "use_io_service": false,
            "maxsize": 10000,
            "wrnsize": 10
        }
    },

    "logger": {
        "enabled": true,
        "startup_priority": -1000,
        "shutdown_priority": 1000,
        "milliseconds": true,
        "single": true,
        "limit": 10000000,
        "path": "/logs/prefixdb-master1",
        "stdout": "cout",
        "syslog": "",
        "deny": [],
        "custom": {}
    },

    "workflow": [
        {
            "enabled": true,
            "name": "main-workflow",
            "startup_priority": 0,
            "shutdown_priority": 0,
            "statistics":"stat1",
            "threads": 4,
            "use_io_service": false,
            "post_delay_ms": 0,
            "rate_limit": 0,
            "maxsize": 134217728,
            "wrnsize": 1048576
        },
        {
            "enabled": true,
            "name": "callback-workflow",
            "startup_priority": 0,
            "shutdown_priority": 0,
            "statistics":"stat1",
            "threads": 2,
            "use_io_service": false,
            "post_delay_ms": 0,
            "rate_limit": 0,
            "maxsize": 134217728,
            "wrnsize": 1048576
        },
        {
            "enabled": true,
            "name": "slave-workflow",
            "startup_priority": 0,
            "shutdown_priority": 0,
            "statistics":"stat1",

            "threads": 1,
            "use_io_service": false,
            "post_delay_ms": 0,
            "rate_limit": 0,
            "maxsize": 134217728,
            "wrnsize": 1048576
        },
        {
            "enabled": true,
            "name": "script-workflow",
            "startup_priority": 0,
            "shutdown_priority": 0,
            "statistics":"stat1",

            "threads": 1,
            "use_io_service": false,
            "post_delay_ms": 0,
            "rate_limit": 0,
            "maxsize": 134217728,
            "wrnsize": 1048576
        },
        {
            "name": "workflow-io",
            "enabled": true,
            "shutdown_priority": 0,
            "startup_priority": 0,
            "statistics": "stat1",
            "threads": 2,

            "maxsize": 134217728,
            "wrnsize": 1048576,

            "post_delay_ms": 0,
            "rate_limit": 0,
            "show_wrn_ms": 1000,
            "use_io_service": false
        },
        {
            "name": "workflow-io-callback",
            "enabled": true,
            "shutdown_priority": 0,
            "startup_priority": 0,
            "statistics": "stat1",
            "threads": 2,

            "maxsize": 134217728,
            "wrnsize": 1048576,

            "post_delay_ms": 0,
            "rate_limit": 0,
            "show_wrn_ms": 1000,
            "use_io_service": false
        }

    ],

  "system-statistics": [
    {
      "name": "system-statistics1",
      "enabled": true,
      "suspend": false,
      "startup_priority": 999,
      "shutdown_priority": 0,
      "workflow": "",
      "statistics": "stat1",
      "prefix": "sys.",
      "interval_ms": 500
    }
  ],


    "statistics": [
        {
            "name": "stat1",
            "enabled": true,
            "shutdown_priority": 0,
            "startup_priority": 0,
            "suspend": true,
    
            "workflow": "" ,
            "step_ms": 500,
            "levels": 16,
            "limit": 4096,
            "reduced_size": 4096,

            /*"log":"stat",*/
            "log_metric":"microseconds",
            "btp_target": "btp-gateway1",

            "prefixes": [
              "service~~daemon:PrefixDB-Test~~",
              "service~~daemon:PrefixDB-Test~~ctest1~~",
              "script~~daemon:PrefixDB-Test-master1~~daemon:PrefixDB-Test~~"
            ]
        }
    ],


    "prefixdb": [
        {
            "enabled": true,
            "name": "prefixdb1",
            "startup_priority": 0,
            "shutdown_priority": 0,
            "suspend": false,

            "path": "/monamour/prefixdb/master1",
            "detach_path": "/monamour/prefixdb/master1_detach",
            "ini": "./rocksdb.ini",
            "preopen": true,
            "auto_repair": false,
            "abort_if_open_error": true,
            "stop_list": [],
            "workflow": "",

            "enable_delayed_write": true,
            "key_size_limit": 256,
            "keys_per_req": 100,
            "array_limit": 1000,
            "packed_limit": 1000,
            "prefix_size_limit": 256,
            "max_prefixes": 128,
            "range_limit": 10000,
            "value_size_limit": 10240
        }
    ],

    "prefixdb-service": [
        {
            "enabled": true,
            "name": "prefixdb-service1",
            "startup_priority": 0,
            "shutdown_priority": 0,
            "suspend": false,

            "target": "prefixdb1",
            "workflow": "",
            "allow_non_jsonrpc": true,
            "remove_everytime": true,
            "call_lifetime_ms": 3000,
            "remove_outdated_ms": 1000
        }
    ],

    "jsonrpc-queue": [
        {
            "enabled": true,
            "name": "main-queue",
            "startup_priority": 0,
            "shutdown_priority": 0,
            "suspend": false,

            "target": "jsonrpc-statistics-db",
            "workflow": "main-workflow",
            "callback_queue": true,
            "callback_workflow": "callback-workflow"
        },
        {
            "enabled": true,
            "name": "script-queue",
            "startup_priority": 0,
            "shutdown_priority": 0,
            "suspend": false,

            "target": "prefixdb-service1",
            "workflow": "script-workflow",
            "callback_queue": false,
            "callback_workflow": ""
        },
        {
            "enabled": true,
            "name": "slave-queue",
            "startup_priority": 0,
            "shutdown_priority": 0,
            "suspend": false,

            "target": "prefixdb-service1",
            "workflow": "slave-workflow",
            "callback_queue": false,
            "callback_workflow": ""
        }
    ],

    "server-tcp": [
        /* Основной порт*/
        {
            "enabled": true,
            "name": "main-tcp",
            "startup_priority": 0,
            "shutdown_priority": 0,
            "suspend": false,

            "target": "io-statistics-main",
            "addr": "0.0.0.0",
            "port": "23510",
            "threads": 1,
            "backlog": 1024,
            "max_connections": 0,
            "workflow": "",
            "keep-alive":true,                                                                                                                                          
            "connection": {
                "keep_alive": true,
                "reader": {
                    "sep": "\r\n",
                    "bufsize": 256,
                    "maxbuf": 8192,
                    "minbuf": 0,
                    "trimsep": true
                },
                "writer": {
                    "sep": "\r\n",
                    "bufsize": 512,
                    "maxbuf": 8192,
                    "minbuf": 0,
                    "first_as_is": true
                }
            }
        },
        /* Порт для скриптов */
        {
            "enabled": true,
            "name": "script-tcp",
            "startup_priority": 0,
            "shutdown_priority": 0,
            "suspend": false,

            "target": "script-queue",
            "addr": "0.0.0.0",
            "port": "23511",
            "threads": 1,
            "backlog": 1024,
            "max_connections": 0,
            "workflow": "",
            "keep-alive":true,
            "connection": {
                "keep_alive": true,
                "reader": {
                    "sep": "\r\n",
                    "bufsize": 4096,
                    "maxbuf": 8192,
                    "minbuf": 0,
                    "trimsep": true
                },
                "writer": {
                    "sep": "\r\n",
                    "bufsize": 8192,
                    "maxbuf": 8192,
                    "minbuf": 0,
                    "first_as_is": true
                }
            }
        },
        /* Порт для слейва */
        {
            "enabled": true,
            "name": "slave-tcp",
            "startup_priority": 0,
            "shutdown_priority": 0,
            "suspend": false,

            "target": "slave-queue",
            "addr": "0.0.0.0",
            "port": "23512",
            "threads": 1,
            "backlog": 1024,
            "max_connections": 0,
            "workflow": "",
            "keep-alive":true,
           
            "connection": {
                "keep_alive": true,
                "reader": {
                    "sep": "\r\n",
                    "bufsize": 4096,
                    "maxbuf": 8192,
                    "minbuf": 0,
                    "trimsep": true
                },
                "writer": {
                    "sep": "\r\n",
                    "bufsize": 8192,
                    "maxbuf": 8192,
                    "minbuf": 0,
                    "first_as_is": true
                }
            }
        },
        /* Порт для raw-запросов */
        {
            "enabled": true,
            "name": "raw-tcp",
            "startup_priority": 0,
            "shutdown_priority": 0,
            "suspend": false,

            "target": "prefixdb-service1",
            "addr": "0.0.0.0",
            "port": "23513",
            "threads": 1,
            "backlog": 1024,
            "max_connections": 0,
            "workflow": "",
            "keep-alive":true,
            "connection": {
                "keep_alive": true,
                "reader": {
                    "sep": "\r\n",
                    "bufsize": 4096,
                    "maxbuf": 8192,
                    "minbuf": 0,
                    "trimsep": true
                },
                "writer": {
                    "sep": "\r\n",
                    "bufsize": 8192,
                    "maxbuf": 8192,
                    "minbuf": 0,
                    "first_as_is": true
                }
            }
        }
    ],

    "io-statistics": [
      {
        "enabled": true,
        "name": "io-statistics-main",
	"interval_ms":1,
        "time_name": "time",
        "read_size_name": "read_size",
	"write_size_name": "write_size",
        "suspend": false,
        "statistics": "stat1",
        "target": "io-queue"
      }
    ],

    "io-queue": [
      {
        "name": "io-queue",
        "enabled": true,
        "suspend": false,
        "startup_priority": 0,
        "shutdown_priority": 0,
        "workflow": "workflow-io",
        "statistics": "stat1",

        "target": "jsonrpc-statistics-main",
        "callback_queue": true,
        "callback_workflow": "workflow-io-callback"
      }
    ],


    "jsonrpc-statistics": [
        {
            "enabled": true,
            "name": "jsonrpc-statistics-main",
            "startup_priority": 0,
            "shutdown_priority": 0,
            "target": "main-queue",
            "suspend": false,
            "statistics": "stat1",
	
            "time_suffix":       ".time",
	    "read_size_suffix":  ".rsize",
            "write_size_suffix": ".wsize",
            "request_prefix":    "req:",
            "notify_prefix:":    "ntf:",
	    "other_time":        "other.time",
            "other_read_size":   "other.rsize",
  	    "other_write_size":  "other.wsize"
        },
        {
            "enabled": true,
            "name": "jsonrpc-statistics-db",
            "startup_priority": 0,
            "shutdown_priority": 0,
            "target": "prefixdb-service1",
            "suspend": false,
            "statistics": "stat1",

            "time_suffix":       ".time",
            "read_size_suffix":  "",
            "write_size_suffix": "",
            "request_prefix":    "req(db):",
            "notify_prefix:":    "ntf(db):",
            "other_time":        "",
            "other_read_size":   "",
            "other_write_size":  ""
        }
    ],

    "btp-gateway": [
      {
        "name": "btp-gateway1",
        "enabled": true,
        "suspend": false,
        "startup_priority": 0,
        "shutdown_priority": 0,
        "workflow": "",

        "allow_non_jsonrpc": false,
        "call_lifetime_ms": 60000,
        "remove_everytime": true,
        "remove_outdated_ms": 0,

        "incoming_reg": false,
        "incoming_target": "",

        "outgoing_reg": true,
        "outgoing_target": "client-btp1"
      }
    ],

    "client-tcp": [
      {
        "addr": "dd2",
        "enabled": true,
        "name": "client-btp1",
        "port": "36000",
        "threads": 1,
        "suspend": false,
        "workflow": ""
      }
    ]

}
