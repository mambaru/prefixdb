PrefixDB - демон префиксного key-value хранилища на базе RocksDB
=========

Демон предоставляет jsonrpc-интерфейс к набору key-value хранилищ определямых префиксом. 
По сути префикс - это имя каталога файловой системы, где распологаются файлы 
хранилища для этого префикса. Он указывается в каждом запросе. Более подробное описание 
в модуле [wfc_prefixdb](http://github.lan/cpp/wfc_prefixdb), где и реализован основной функционал.

Непосредственно демон реализован на фреймворке WFC-0.6 и, соответсвенно, доступны все возможности этого фреймворка, 
включая репликацию на сетевом уровне, как в демоне LevelDB. Но RocksDB предоставляет более
надежные механизмы репликации на уровне файловой системы. 

RocksDB - это активно развивающийся проект facebook, изначально форк проекта LevelDB от google,
с существенными дополнениями. По мимо встроеных механизмов бэкапов (в том числе инкрементальных),
и множества дополнительных настроек, RocksDB предоставляет механизм мерджинга, который позволяет
полностью избавиться от блокировок ключей для модифицирующих операций, требующих предварительного
получения значения (например инкрементальных). Это потребовало существенных изменний в логике работы 
демона, поэтому некоторые операции, аналогичные LevelDB, работают иначе. Внимательнее читайте 
описание API для [wfc_prefixdb](http://github.lan/cpp/wfc_prefixdb).

# Исходный код и компиляция

Проект содержит несколько субмодулей git, один из которых, wfcroot, также содержит набор субмодулей 
(как, впрочем и все проекты wfc-0.6). На данный момент актуальный код в бранче devel-0.6, в одноименном 
бранче и код wfc-0.6:

```bash
git clone git@github.lan:cpp/prefixdbd.git
cd prefixdbd
git checkout release-0.6
git submodule update --init --recursive 
```

Зависимые проекты RocksDB и LuaJIT форкнуты репозитарий мамбы и собираються вместе с основным проеком. 
Для продакшена сборку нужно производить на хосте 10.5.13.222. Все проекты мамбы требуют компилятор 
g++4.7 и выше, но RocksDB нуженf более старшая версия. Поэтому на сборочной тачке установлен devtoolset-2
с более свежим компилятором 4.8.2, и чтобы он стал доступен необходимо инициализировать окружение. Так-же
необходимо инициализировать переменную PORTABLE:

```bash
scl enable devtoolset-2 bash
export PORTABLE=1
mkdir build
cd build
cmake ..
make
cd ./Release/
```

На данный момент бинарник и все библиотеки wfc найдете в ./build/Release и ./build/Release/lib, а бинарники RocksDB и LuaJIT в 
каталогах исходников на месте - на продакшн их нужно скопировать в lib вручную.

Для запуска нужен libgflags.so.2, его можно найти здесь 10.5.13.222:/usr/local/lib/libgflags.so.2. Позже этот проект также 
будет перенесен в репозитарий мамбы.

Так-же пока нет описания конфигурирования фреймворка WFC, но актуальный конфиг для продакшена будет в папке ./configurations по
мере вывода проекта в бой. Тонкие настроки RocksDB будут в ini-файле, более подробную инфу можно найти на http://rocksdb.org/